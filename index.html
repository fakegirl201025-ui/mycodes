<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Store BD</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary: #4285f4;
            --primary-dark: #1a73e8;
            --secondary: #34a853;
            --danger: #ea4335;
            --warning: #fbbc04;
            --playstore-bg: #f8f9fa;
            --playstore-surface: #ffffff;
            --playstore-card: #ffffff;
            --playstore-border: #dadce0;
            --playstore-text: #202124;
            --playstore-text-secondary: #5f6368;
            --playstore-elevation-1: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            --playstore-elevation-2: 0 1px 2px 0 rgba(60,64,67,0.3), 0 2px 6px 2px rgba(60,64,67,0.15);
            --playstore-elevation-3: 0 1px 3px 0 rgba(60,64,67,0.3), 0 4px 8px 3px rgba(60,64,67,0.15);
            --gradient-gaming: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #34a853 0%, #0f9d58 100%);
            --gaming-accent: #ff375f;
            --gaming-dark: #121212;
            --gaming-card: #1c1c1e;
            --gaming-text: #ffffff;
            --transition-speed: 120ms;
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 20px;
            --border-radius-xl: 28px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
        }

        body {
            background-color: var(--playstore-bg);
            color: var(--playstore-text);
            font-family: 'Google Sans', 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: background-color 0.3s ease;
            will-change: transform;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        body.gaming-mode {
            background-color: var(--gaming-dark);
            color: var(--gaming-text);
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--playstore-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        #loading-screen.gaming-mode {
            background: var(--gaming-dark);
        }

        .loading-logo {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .loading-logo .logo-text {
            background: linear-gradient(135deg, #4285f4, #34a853, #fbbc04, #ea4335);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: gradientShift 3s ease infinite;
        }

        .loading-logo.gaming-mode .logo-text {
            background: var(--gradient-gaming);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .loading-progress-container {
            width: 280px;
            height: 8px;
            background: var(--playstore-border);
            border-radius: 100px;
            overflow: hidden;
            position: relative;
        }

        .loading-progress-container.gaming-mode {
            background: rgba(255,255,255,0.1);
        }

        .loading-progress-bar {
            position: absolute;
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4285f4, #1a73e8);
            border-radius: 100px;
            animation: loadingProgress 2.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .loading-progress-bar.gaming-mode {
            background: var(--gradient-gaming);
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 100;
            background: var(--playstore-surface);
            border: 1px solid var(--playstore-border);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--playstore-elevation-1);
            transition: all var(--transition-speed) ease;
        }

        .theme-toggle:hover {
            transform: scale(1.05);
            box-shadow: var(--playstore-elevation-2);
        }

        .theme-toggle.gaming-mode {
            background: var(--gaming-card);
            border-color: rgba(255,255,255,0.1);
        }

        .theme-toggle i {
            font-size: 1.4rem;
            color: var(--playstore-text);
            transition: all var(--transition-speed) ease;
        }

        .theme-toggle.gaming-mode i {
            color: var(--gaming-text);
        }

        /* Main App Container */
        .app-container {
            display: none;
            max-width: 100%;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            contain: layout paint;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: var(--playstore-surface);
            border-bottom: 1px solid var(--playstore-border);
            position: sticky;
            top: 0;
            z-index: 90;
            transition: all var(--transition-speed) ease;
            will-change: transform;
        }

        .header.gaming-mode {
            background: var(--gaming-card);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* MODERN LOGO */
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
        }

        .logo-icon.gaming-mode {
            background: linear-gradient(135deg, #ff375f 0%, #ff6b9d 100%);
            box-shadow: 0 4px 12px rgba(255, 55, 95, 0.4);
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #4285f4, #1a73e8);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo-text.gaming-mode {
            background: var(--gradient-gaming);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4285f4, #1a73e8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            box-shadow: var(--playstore-elevation-1);
        }

        .user-avatar.gaming-mode {
            background: var(--gradient-gaming);
        }

        .user-avatar:hover {
            transform: scale(1.05);
            box-shadow: var(--playstore-elevation-2);
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--playstore-surface);
            border-top: 1px solid var(--playstore-border);
            padding: 12px 0;
            z-index: 95;
            transition: all var(--transition-speed) ease;
            will-change: transform;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        .bottom-nav.gaming-mode {
            background: var(--gaming-card);
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            color: var(--playstore-text-secondary);
            text-decoration: none;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all var(--transition-speed) ease;
            position: relative;
            padding: 8px 16px;
            border-radius: var(--border-radius-lg);
        }

        .nav-item.gaming-mode {
            color: rgba(255,255,255,0.7);
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item.gaming-mode.active {
            color: #ff375f;
        }

        .nav-icon {
            font-size: 1.4rem;
            transition: all var(--transition-speed) ease;
        }

        .nav-item.active .nav-icon {
            transform: translateY(-2px);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -12px;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
        }

        .nav-item.gaming-mode.active::after {
            background: #ff375f;
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            padding-bottom: 80px;
            min-height: calc(100vh - 80px);
            overflow-y: auto;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            will-change: transform;
        }

        .page {
            display: none;
            animation: pageFadeIn 0.3s ease forwards;
        }

        .page.active {
            display: block;
        }

        /* Page Titles */
        .page-header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--playstore-text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-title.gaming-mode {
            color: var(--gaming-text);
        }

        .page-title i {
            color: var(--primary);
        }

        .page-title.gaming-mode i {
            color: #ff375f;
        }

        .page-subtitle {
            font-size: 0.95rem;
            color: var(--playstore-text-secondary);
            margin-top: 4px;
        }

        .page-subtitle.gaming-mode {
            color: rgba(255,255,255,0.7);
        }

        /* Tabs */
        .tabs-container {
            margin-bottom: 24px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            white-space: nowrap;
        }

        .tabs-container::-webkit-scrollbar {
            display: none;
        }

        .tabs {
            display: inline-flex;
            background: var(--playstore-surface);
            border: 1px solid var(--playstore-border);
            border-radius: var(--border-radius-lg);
            padding: 4px;
            box-shadow: var(--playstore-elevation-1);
            transition: all var(--transition-speed) ease;
        }

        .tabs.gaming-mode {
            background: var(--gaming-card);
            border-color: rgba(255,255,255,0.1);
        }

        .tab {
            padding: 10px 20px;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-weight: 500;
            transition: all var(--transition-speed) ease;
            color: var(--playstore-text-secondary);
            flex-shrink: 0;
        }

        .tab.gaming-mode {
            color: rgba(255,255,255,0.7);
        }

        .tab.active {
            background: linear-gradient(135deg, #4285f4, #1a73e8);
            color: white;
            box-shadow: var(--playstore-elevation-1);
        }

        .tab.gaming-mode.active {
            background: var(--gradient-gaming);
        }

        /* Files Grid */
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        @media (max-width: 600px) {
            .files-grid {
                grid-template-columns: 1fr;
            }
        }

        .file-card {
            background: var(--playstore-card);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--playstore-border);
            box-shadow: var(--playstore-elevation-1);
            animation: cardAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1) backwards;
            will-change: transform, box-shadow;
            contain: layout;
        }

        .file-card.gaming-mode {
            background: var(--gaming-card);
            border-color: rgba(255,255,255,0.1);
        }

        .file-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--playstore-elevation-3);
        }

        .file-card.gaming-mode:hover {
            box-shadow: 0 8px 32px rgba(255, 55, 95, 0.2);
        }

        .file-banner {
            height: 160px;
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            position: relative;
            overflow: hidden;
        }

        .file-banner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .file-card:hover .file-banner img {
            transform: scale(1.05);
        }

        .file-price-tag {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .file-content {
            padding: 16px;
        }

        .file-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--playstore-text);
            line-height: 1.4;
        }

        .file-title.gaming-mode {
            color: var(--gaming-text);
        }

        .file-description {
            font-size: 0.9rem;
            color: var(--playstore-text-secondary);
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .file-description.gaming-mode {
            color: rgba(255,255,255,0.7);
        }

        .file-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--playstore-text-secondary);
        }

        .file-meta.gaming-mode {
            color: rgba(255,255,255,0.5);
        }

        .file-meta i {
            font-size: 0.9rem;
        }

        .btn-get {
            background: linear-gradient(135deg, #4285f4, #1a73e8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            box-shadow: var(--playstore-elevation-1);
        }

        .btn-get.gaming-mode {
            background: var(--gradient-gaming);
        }

        .btn-get:hover {
            transform: translateY(-2px);
            box-shadow: var(--playstore-elevation-2);
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease forwards;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--playstore-surface);
            border-radius: var(--border-radius-xl);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            box-shadow: var(--playstore-elevation-3);
            display: flex;
            flex-direction: column;
        }

        .modal.gaming-mode {
            background: var(--gaming-card);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--playstore-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .modal-header.gaming-mode {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--playstore-text);
        }

        .modal-title.gaming-mode {
            color: var(--gaming-text);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--playstore-text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-speed) ease;
        }

        .modal-close:hover {
            background: var(--playstore-bg);
        }

        .modal-close.gaming-mode {
            color: rgba(255,255,255,0.7);
        }

        .modal-close.gaming-mode:hover {
            background: rgba(255,255,255,0.1);
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--playstore-border);
            display: flex;
            gap: 12px;
            flex-shrink: 0;
        }

        .modal-footer.gaming-mode {
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* Auth Modal */
        .auth-tabs {
            display: flex;
            margin-bottom: 24px;
            background: var(--playstore-surface);
            border-radius: var(--border-radius-lg);
            padding: 4px;
            border: 1px solid var(--playstore-border);
        }

        .auth-tabs.gaming-mode {
            background: var(--gaming-card);
            border-color: rgba(255,255,255,0.1);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-weight: 600;
            color: var(--playstore-text-secondary);
            transition: all var(--transition-speed) ease;
        }

        .auth-tab.gaming-mode {
            color: rgba(255,255,255,0.7);
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #4285f4, #1a73e8);
            color: white;
            box-shadow: var(--playstore-elevation-1);
        }

        .auth-tab.gaming-mode.active {
            background: var(--gradient-gaming);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.3s ease forwards;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--playstore-text);
            font-size: 0.95rem;
        }

        .form-label.gaming-mode {
            color: var(--gaming-text);
        }

        .form-input {
            width: 100%;
            padding: 14px;
            background: var(--playstore-bg);
            border: 2px solid var(--playstore-border);
            border-radius: var(--border-radius-md);
            color: var(--playstore-text);
            font-size: 1rem;
            transition: all var(--transition-speed) ease;
        }

        .form-input.gaming-mode {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.1);
            color: var(--gaming-text);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }

        .form-input.gaming-mode:focus {
            border-color: #ff375f;
            box-shadow: 0 0 0 3px rgba(255, 55, 95, 0.1);
        }

        .form-error {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 6px;
            display: none;
        }

        /* Buttons */
        .btn {
            padding: 14px 24px;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4285f4, #1a73e8);
            color: white;
            box-shadow: var(--playstore-elevation-1);
        }

        .btn-primary.gaming-mode {
            background: var(--gradient-gaming);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--playstore-elevation-2);
        }

        .btn-secondary {
            background: var(--playstore-surface);
            color: var(--playstore-text);
            border: 2px solid var(--playstore-border);
        }

        .btn-secondary.gaming-mode {
            background: var(--gaming-card);
            color: var(--gaming-text);
            border-color: rgba(255,255,255,0.1);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
            box-shadow: var(--playstore-elevation-1);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ea4335, #d93025);
            color: white;
            box-shadow: var(--playstore-elevation-1);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Payment Modal */
        .payment-details {
            background: var(--playstore-bg);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            margin-bottom: 24px;
        }

        .payment-details.gaming-mode {
            background: rgba(255,255,255,0.05);
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--playstore-border);
        }

        .payment-item.gaming-mode {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .payment-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .payment-label {
            color: var(--playstore-text-secondary);
            font-weight: 500;
        }

        .payment-label.gaming-mode {
            color: rgba(255,255,255,0.7);
        }

        .payment-value {
            font-weight: 700;
            color: var(--playstore-text);
        }

        .payment-value.gaming-mode {
            color: var(--gaming-text);
        }

        .bkash-container {
            background: linear-gradient(135deg, #d91a73, #a60e5c);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            color: white;
            margin-bottom: 24px;
            text-align: center;
        }

        .bkash-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .bkash-number {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 1px;
            margin-bottom: 16px;
            font-family: 'Courier New', monospace;
        }

        .btn-copy {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: all var(--transition-speed) ease;
        }

        .btn-copy:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Vault Page */
        .vault-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .notification-card {
            background: var(--playstore-surface);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            border-left: 6px solid var(--playstore-border);
            box-shadow: var(--playstore-elevation-1);
            animation: cardAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1) backwards;
        }

        .notification-card.gaming-mode {
            background: var(--gaming-card);
            border-left-color: rgba(255,255,255,0.1);
        }

        .notification-card.pending {
            border-left-color: var(--warning);
        }

        .notification-card.approved {
            border-left-color: var(--secondary);
        }

        .notification-card.rejected {
            border-left-color: var(--danger);
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .notification-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--playstore-text);
        }

        .notification-title.gaming-mode {
            color: var(--gaming-text);
        }

        .notification-time {
            color: var(--playstore-text-secondary);
            font-size: 0.85rem;
        }

        .notification-time.gaming-mode {
            color: rgba(255,255,255,0.5);
        }

        .notification-message {
            color: var(--playstore-text-secondary);
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .notification-message.gaming-mode {
            color: rgba(255,255,255,0.7);
        }

        /* Profile Page */
        .profile-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 20px 0;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4285f4, #1a73e8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
            box-shadow: var(--playstore-elevation-2);
        }

        .profile-avatar.gaming-mode {
            background: var(--gradient-gaming);
        }

        .profile-name {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--playstore-text);
        }

        .profile-name.gaming-mode {
            color: var(--gaming-text);
        }

        /* USER INFO CARD */
        .user-info-card {
            background: var(--playstore-surface);
            border-radius: var(--border-radius-lg);
            padding: 24px;
            box-shadow: var(--playstore-elevation-1);
            width: 100%;
            max-width: 400px;
            margin-bottom: 32px;
        }

        .user-info-card.gaming-mode {
            background: var(--gaming-card);
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--playstore-border);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-item.gaming-mode {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .info-item i {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4285f4, #1a73e8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
        }

        .info-item.gaming-mode i {
            background: var(--gradient-gaming);
        }

        .info-label {
            font-size: 0.85rem;
            color: var(--playstore-text-secondary);
            margin-bottom: 4px;
            font-weight: 500;
        }

        .info-label.gaming-mode {
            color: rgba(255,255,255,0.6);
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--playstore-text);
        }

        .info-value.gaming-mode {
            color: var(--gaming-text);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            width: 100%;
            max-width: 500px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--playstore-surface);
            border-radius: var(--border-radius-lg);
            padding: 24px;
            text-align: center;
            box-shadow: var(--playstore-elevation-1);
            transition: all var(--transition-speed) ease;
        }

        .stat-card.gaming-mode {
            background: var(--gaming-card);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--playstore-elevation-2);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #4285f4, #1a73e8);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .stat-value.gaming-mode {
            background: var(--gradient-gaming);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .stat-label {
            color: var(--playstore-text-secondary);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .stat-label.gaming-mode {
            color: rgba(255,255,255,0.7);
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--playstore-text-secondary);
        }

        .empty-state.gaming-mode {
            color: rgba(255,255,255,0.5);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--playstore-text);
        }

        .empty-title.gaming-mode {
            color: var(--gaming-text);
        }

        .empty-message {
            font-size: 1rem;
            max-width: 400px;
            margin: 0 auto;
        }

        /* Animations */
        @keyframes loadingProgress {
            0% { width: 0%; }
            20% { width: 30%; }
            40% { width: 60%; }
            60% { width: 80%; }
            80% { width: 95%; }
            100% { width: 100%; }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes pageFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes cardAppear {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(100px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Forced Login Overlay */
        .forced-login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--playstore-bg);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            text-align: center;
            padding: 40px;
            animation: fadeIn 0.5s ease forwards;
        }

        .forced-login-overlay.gaming-mode {
            background: var(--gaming-dark);
        }

        .forced-login-message {
            max-width: 500px;
        }

        .forced-login-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 24px;
        }

        .forced-login-icon.gaming-mode {
            color: #ff375f;
        }

        .forced-login-message h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--playstore-text);
        }

        .forced-login-message h2.gaming-mode {
            color: var(--gaming-text);
        }

        .forced-login-message p {
            font-size: 1.1rem;
            color: var(--playstore-text-secondary);
            margin-bottom: 32px;
            line-height: 1.6;
        }

        .forced-login-message p.gaming-mode {
            color: rgba(255,255,255,0.7);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
            width: 90%;
        }

        .toast {
            background: var(--playstore-surface);
            color: var(--playstore-text);
            padding: 16px 20px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--playstore-elevation-3);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: toastSlideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            border-left: 4px solid var(--primary);
        }

        .toast.gaming-mode {
            background: var(--gaming-card);
            color: var(--gaming-text);
            border-left-color: #ff375f;
        }

        .toast.success {
            border-left-color: var(--secondary);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast-message {
            flex: 1;
            font-weight: 500;
        }

        @keyframes toastSlideUp {
            from {
                opacity: 0;
                transform: translateY(100px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (min-width: 768px) {
            .bottom-nav {
                display: none;
            }
            
            .app-container {
                display: grid;
                grid-template-columns: 250px 1fr;
                grid-template-rows: auto 1fr;
                grid-template-areas: 
                    "header header"
                    "sidebar main";
                height: 100vh;
            }
            
            .header {
                grid-area: header;
            }
            
            .sidebar {
                grid-area: sidebar;
                background: var(--playstore-surface);
                border-right: 1px solid var(--playstore-border);
                padding: 24px;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                gap: 8px;
            }
            
            .sidebar.gaming-mode {
                background: var(--gaming-card);
                border-right: 1px solid rgba(255,255,255,0.1);
            }
            
            .main-content {
                grid-area: main;
                padding: 32px;
                padding-bottom: 32px;
                overflow-y: auto;
            }
            
            .desktop-nav-item {
                display: flex;
                align-items: center;
                gap: 16px;
                padding: 16px;
                border-radius: var(--border-radius-lg);
                color: var(--playstore-text-secondary);
                text-decoration: none;
                font-weight: 500;
                transition: all var(--transition-speed) ease;
                cursor: pointer;
            }
            
            .desktop-nav-item.gaming-mode {
                color: rgba(255,255,255,0.7);
            }
            
            .desktop-nav-item:hover {
                background: var(--playstore-bg);
            }
            
            .desktop-nav-item.gaming-mode:hover {
                background: rgba(255,255,255,0.05);
            }
            
            .desktop-nav-item.active {
                background: linear-gradient(135deg, #4285f4, #1a73e8);
                color: white;
                box-shadow: var(--playstore-elevation-1);
            }
            
            .desktop-nav-item.gaming-mode.active {
                background: var(--gradient-gaming);
            }
            
            .desktop-nav-icon {
                font-size: 1.2rem;
                width: 24px;
                text-align: center;
            }
        }

        @media (max-width: 767px) {
            .sidebar {
                display: none;
            }
            
            .app-container {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-logo">
            <div class="logo-icon">C</div>
            <div class="logo-text">Code Store BD</div>
        </div>
        <div class="loading-progress-container">
            <div class="loading-progress-bar"></div>
        </div>
    </div>
    
    <!-- Theme Toggle -->
    <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-sun"></i>
    </div>
    
    <!-- Forced Login Overlay -->
    <div id="forcedLoginOverlay" class="forced-login-overlay">
        <div class="forced-login-message">
            <div class="forced-login-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h2>Welcome to Code Store BD</h2>
            <p>Please login or register to access premium files and features</p>
            <button class="btn btn-primary" id="showLoginFromForced">
                <i class="fas fa-sign-in-alt"></i> Login / Register
            </button>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Main App Container -->
    <div class="app-container">
        <header class="header">
            <div class="logo">
                <div class="logo-icon" id="headerLogoIcon">C</div>
                <div class="logo-text" id="headerLogoText">Code Store BD</div>
            </div>
            <div class="header-actions">
                <div class="user-avatar" id="userAvatar">?</div>
            </div>
        </header>
        
        <div class="sidebar">
            <div class="desktop-nav-item active" data-page="home">
                <i class="fas fa-home desktop-nav-icon"></i>
                <span>Home</span>
            </div>
            <div class="desktop-nav-item" data-page="vault">
                <i class="fas fa-vault desktop-nav-icon"></i>
                <span>My Vault</span>
            </div>
            <div class="desktop-nav-item" data-page="profile">
                <i class="fas fa-user desktop-nav-icon"></i>
                <span>Profile</span>
            </div>
            <div class="desktop-nav-item" id="themeToggleDesktop">
                <i class="fas fa-sun desktop-nav-icon"></i>
                <span>Dark Mode</span>
            </div>
        </div>
        
        <main class="main-content" id="mainContent">
            <!-- Home Page -->
            <div id="homePage" class="page active">
                <div class="page-header">
                    <div>
                        <h1 class="page-title"><i class="fas fa-fire"></i> Trending Files</h1>
                        <p class="page-subtitle">Premium scripts, templates, and assets for developers</p>
                    </div>
                </div>
                
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="all">All Files</div>
                        <div class="tab" data-tab="free">Free</div>
                        <div class="tab" data-tab="paid">Premium</div>
                    </div>
                </div>
                
                <div class="files-grid" id="filesGrid">
                    <!-- Files will be loaded here -->
                </div>
            </div>
            
            <!-- Vault Page -->
            <div id="vaultPage" class="page">
                <div class="page-header">
                    <div>
                        <h1 class="page-title"><i class="fas fa-vault"></i> My Vault</h1>
                        <p class="page-subtitle">Your purchased files and notifications</p>
                    </div>
                </div>
                
                <div class="vault-container" id="vaultContainer">
                    <!-- Notifications will be loaded here -->
                </div>
            </div>
            
            <!-- Profile Page -->
            <div id="profilePage" class="page">
                <div class="profile-container">
                    <div class="profile-avatar" id="profileAvatar">U</div>
                    <h1 class="profile-name" id="profileName">User Name</h1>
                    
                    <!-- User Info Card -->
                    <div class="user-info-card">
                        <div class="info-item">
                            <i class="fas fa-phone"></i>
                            <div>
                                <div class="info-label">Phone</div>
                                <div class="info-value" id="profilePhone">+8801XXXXXXXXX</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <div class="info-label">Email</div>
                                <div class="info-value" id="profileEmail">user@example.com</div>
                            </div>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-calendar-alt"></i>
                            <div>
                                <div class="info-label">Member Since</div>
                                <div class="info-value" id="profileJoined">January 2024</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="totalPurchases">0</div>
                            <div class="stat-label">Total Purchases</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalSpent">à§³0</div>
                            <div class="stat-label">Total Spent</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 300px;">
                        <button class="btn btn-primary" id="refreshProfileBtn">
                            <i class="fas fa-sync-alt"></i> Refresh Profile
                        </button>
                        <button class="btn btn-danger" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Mobile Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" data-page="home">
                <i class="fas fa-home nav-icon"></i>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" data-page="vault">
                <i class="fas fa-vault nav-icon"></i>
                <span>Vault</span>
            </a>
            <a href="#" class="nav-item" data-page="profile">
                <i class="fas fa-user nav-icon"></i>
                <span>Profile</span>
            </a>
        </nav>
    </div>
    
    <!-- Login/Register Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Welcome to Code Store BD</h2>
                <button class="modal-close" id="closeLoginModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-auth="login">Login</div>
                    <div class="auth-tab" data-auth="register">Register</div>
                </div>
                
                <form class="auth-form active" id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="loginEmail">Email</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="Enter your email" required>
                        <div class="form-error" id="loginEmailError"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Password</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" required>
                        <div class="form-error" id="loginPasswordError"></div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="loginSubmitBtn">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                
                <form class="auth-form" id="registerForm">
                    <div class="form-group">
                        <label class="form-label" for="registerName">Full Name</label>
                        <input type="text" class="form-input" id="registerName" placeholder="Enter your full name" required>
                        <div class="form-error" id="registerNameError"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerPhone">Phone Number</label>
                        <input type="tel" class="form-input" id="registerPhone" placeholder="Enter your phone number" required>
                        <div class="form-error" id="registerPhoneError"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerEmail">Email</label>
                        <input type="email" class="form-input" id="registerEmail" placeholder="Enter your email" required>
                        <div class="form-error" id="registerEmailError"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="registerPassword">Password (min 6 characters)</label>
                        <input type="password" class="form-input" id="registerPassword" placeholder="Create a password" required>
                        <div class="form-error" id="registerPasswordError"></div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="registerSubmitBtn">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- File Details Modal -->
    <div class="modal-overlay" id="fileDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="fileModalTitle">File Details</h2>
                <button class="modal-close" id="closeFileModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="fileModalContent"></div>
            </div>
        </div>
    </div>
    
    <!-- Payment Modal -->
    <div class="modal-overlay" id="paymentModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Complete Purchase</h2>
                <button class="modal-close" id="closePaymentModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="payment-details">
                    <div class="payment-item">
                        <span class="payment-label">Product:</span>
                        <span class="payment-value" id="paymentProduct">Product Name</span>
                    </div>
                    <div class="payment-item">
                        <span class="payment-label">Price:</span>
                        <span class="payment-value" id="paymentPrice">à§³0</span>
                    </div>
                    <div class="payment-item">
                        <span class="payment-label">Payment Method:</span>
                        <span class="payment-value">bKash</span>
                    </div>
                </div>
                
                <div class="bkash-container">
                    <div class="bkash-label">Send payment to this bKash number:</div>
                    <div class="bkash-number" id="bkashNumber">01XXXXXXXXX</div>
                    <button class="btn-copy" id="copyBkashBtn">
                        <i class="fas fa-copy"></i> Copy Number
                    </button>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="trxId">Transaction ID (TRX ID)</label>
                    <input type="text" class="form-input" id="trxId" placeholder="Enter your bKash TRX ID" required>
                    <div class="form-error" id="trxIdError"></div>
                    <p style="font-size: 0.85rem; color: var(--playstore-text-secondary); margin-top: 8px;">
                        <i class="fas fa-info-circle"></i> You can find the TRX ID in your bKash transaction history
                    </p>
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelPaymentBtn">Cancel</button>
                    <button class="btn btn-success" id="submitPaymentBtn">
                        <i class="fas fa-paper-plane"></i> Submit Payment
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Payment Success Modal -->
    <div class="modal-overlay" id="paymentSuccessModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Payment Submitted!</h2>
                <button class="modal-close" id="closeSuccessModal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 20px 0;">
                    <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--secondary); margin-bottom: 20px;"></i>
                    <h3 style="margin-bottom: 12px; font-weight: 700;">Payment Submitted Successfully</h3>
                    <p style="color: var(--playstore-text-secondary); margin-bottom: 16px; line-height: 1.6;">
                        Your payment of <strong id="successAmount">à§³0</strong> for <strong id="successProduct">Product Name</strong> has been submitted for review.
                    </p>
                    <p style="color: var(--playstore-text-secondary); margin-bottom: 24px; line-height: 1.6;">
                        <i class="fas fa-clock"></i> Admin processing time: <strong>Under 24 hours</strong>
                    </p>
                    <div style="background: rgba(251, 188, 4, 0.1); padding: 16px; border-radius: var(--border-radius-md); border-left: 4px solid var(--warning); margin-bottom: 24px;">
                        <p style="color: var(--playstore-text); margin: 0; font-size: 0.95rem;">
                            <i class="fas fa-info-circle"></i> You can check the status in your <strong>Vault</strong> section.
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="goToVaultBtn" style="width: 100%;">
                        <i class="fas fa-vault"></i> Go to Vault
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Firebase Configuration -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyArwHqyI9Om48iChEeGBVPRxHLz2sKLAoU",
            authDomain: "code-store-bd.firebaseapp.com",
            projectId: "code-store-bd",
            storageBucket: "code-store-bd.firebasestorage.app",
            messagingSenderId: "935626127018",
            appId: "1:935626127018:web:f86d9065246bf7ed4a82d3",
            measurementId: "G-MDJSF653QY"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database(); // ð¥ REALTIME DATABASE
    </script>
    
    <script>
        // Global variables
        let currentUser = null;
        let currentFile = null;
        let files = [];
        let notifications = [];
        let payments = [];
        let isGamingMode = false;
        
        // DOM Elements
        const loadingScreen = document.getElementById('loading-screen');
        const themeToggle = document.getElementById('themeToggle');
        const themeToggleDesktop = document.getElementById('themeToggleDesktop');
        const forcedLoginOverlay = document.getElementById('forcedLoginOverlay');
        const toastContainer = document.getElementById('toastContainer');
        const appContainer = document.querySelector('.app-container');
        const loginModal = document.getElementById('loginModal');
        const fileDetailsModal = document.getElementById('fileDetailsModal');
        const paymentModal = document.getElementById('paymentModal');
        const paymentSuccessModal = document.getElementById('paymentSuccessModal');
        const filesGrid = document.getElementById('filesGrid');
        const vaultContainer = document.getElementById('vaultContainer');
        const userAvatar = document.getElementById('userAvatar');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileName = document.getElementById('profileName');
        const totalPurchases = document.getElementById('totalPurchases');
        const totalSpent = document.getElementById('totalSpent');
        const logoutBtn = document.getElementById('logoutBtn');
        const refreshProfileBtn = document.getElementById('refreshProfileBtn');
        const showLoginFromForced = document.getElementById('showLoginFromForced');
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            const progressBar = document.querySelector('.loading-progress-bar');
            progressBar.style.animation = 'loadingProgress 2.5s cubic-bezier(0.4, 0, 0.2, 1) forwards';
            
            const savedTheme = localStorage.getItem('codestore_theme');
            if (savedTheme === 'gaming') {
                enableGamingMode();
            }
            
            setTimeout(() => {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    checkAuth();
                }, 500);
            }, 2800);
            
            setupEventListeners();
        });
        
        // Theme toggle
        function toggleTheme() {
            if (isGamingMode) {
                disableGamingMode();
            } else {
                enableGamingMode();
            }
            updateUITheme();
        }
        
        function enableGamingMode() {
            isGamingMode = true;
            document.body.classList.add('gaming-mode');
            localStorage.setItem('codestore_theme', 'gaming');
            themeToggle.querySelector('i').className = 'fas fa-moon';
            if (themeToggleDesktop) {
                themeToggleDesktop.querySelector('span').textContent = 'Light Mode';
                themeToggleDesktop.querySelector('i').className = 'fas fa-moon';
            }
        }
        
        function disableGamingMode() {
            isGamingMode = false;
            document.body.classList.remove('gaming-mode');
            localStorage.setItem('codestore_theme', 'light');
            themeToggle.querySelector('i').className = 'fas fa-sun';
            if (themeToggleDesktop) {
                themeToggleDesktop.querySelector('span').textContent = 'Dark Mode';
                themeToggleDesktop.querySelector('i').className = 'fas fa-sun';
            }
        }
        
        function updateUITheme() {
            document.querySelectorAll('.theme-toggle, .header, .logo-icon, .logo-text, .user-avatar, .bottom-nav, .nav-item, .page-title, .page-subtitle, .tabs, .tab, .file-card, .file-title, .file-description, .file-meta, .btn-get, .modal, .modal-header, .modal-title, .modal-close, .auth-tabs, .auth-tab, .form-label, .form-input, .btn-primary, .btn-secondary, .payment-details, .payment-item, .payment-label, .payment-value, .notification-card, .notification-title, .notification-time, .notification-message, .profile-avatar, .profile-name, .profile-email, .stat-card, .stat-value, .stat-label, .empty-state, .empty-title, .forced-login-overlay, .forced-login-icon, .forced-login-message h2, .forced-login-message p, .toast, .sidebar, .desktop-nav-item')
                .forEach(el => {
                    if (isGamingMode) {
                        el.classList.add('gaming-mode');
                    } else {
                        el.classList.remove('gaming-mode');
                    }
                });
        }
        
        // Toast notification
        function showToast(message, type = 'info', duration = 4000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}${isGamingMode ? ' gaming-mode' : ''}`;
            
            let icon = 'fas fa-info-circle';
            if (type === 'success') icon = 'fas fa-check-circle';
            if (type === 'error') icon = 'fas fa-exclamation-circle';
            if (type === 'warning') icon = 'fas fa-exclamation-triangle';
            
            toast.innerHTML = `<i class="${icon} toast-icon"></i><div class="toast-message">${message}</div>`;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(20px)';
                setTimeout(() => toast.remove(), 300);
            }, duration);
            
            if (toastContainer.children.length > 3) {
                toastContainer.removeChild(toastContainer.firstChild);
            }
        }
        
        // Check authentication
        function checkAuth() {
            auth.onAuthStateChanged((user) => {
                console.log("Auth state changed:", user ? "User logged in" : "No user");
                
                if (user) {
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        name: user.displayName || user.email.split('@')[0],
                        phone: ''
                    };
                    
                    console.log("â User authenticated:", currentUser.uid);
                    
                    forcedLoginOverlay.style.display = 'none';
                    appContainer.style.display = 'grid';
                    
                    // Load user data from Realtime Database
                    loadUserData(user.uid);
                    updateUIForUser();
                    loadFiles();
                    loadNotifications();
                    loadPayments();
                    setupRealTimeListeners();
                    
                } else {
                    console.log("â No user logged in");
                    forcedLoginOverlay.style.display = 'flex';
                    appContainer.style.display = 'none';
                    currentUser = null;
                    filesGrid.innerHTML = `<div class="empty-state${isGamingMode ? ' gaming-mode' : ''}"><div class="empty-icon"><i class="fas fa-sign-in-alt"></i></div><h2 class="empty-title${isGamingMode ? ' gaming-mode' : ''}">Login Required</h2><p class="empty-message">Please login to browse premium files</p></div>`;
                }
            });
        }
        
        // Load user data from Realtime Database
        function loadUserData(userId) {
            db.ref('users/' + userId).once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        currentUser = { ...currentUser, ...userData };
                        updateProfileUI();
                    } else {
                        createUserDocument(userId);
                    }
                })
                .catch((error) => {
                    console.error("Error loading user data:", error);
                    showToast("Failed to load user data", "error");
                });
        }
        
        // Create user document in Realtime Database
        function createUserDocument(userId) {
            const userData = {
                uid: userId,
                email: currentUser.email,
                name: currentUser.name || currentUser.email.split('@')[0],
                phone: '',
                createdAt: new Date().toISOString(),
                purchaseCount: 0,
                totalSpent: 0,
                lastLogin: new Date().toISOString()
            };
            
            db.ref('users/' + userId).set(userData)
                .then(() => {
                    console.log("â User document created in Realtime DB");
                    currentUser = { ...currentUser, ...userData };
                    updateProfileUI();
                })
                .catch((error) => {
                    console.error("Error creating user document:", error);
                });
        }
        
        // Load files from Realtime Database
        function loadFiles() {
            console.log("ð Loading files from Realtime DB...");
            
            filesGrid.innerHTML = `<div class="empty-state${isGamingMode ? ' gaming-mode' : ''}" style="grid-column: 1 / -1;"><div class="empty-icon"><i class="fas fa-spinner fa-spin"></i></div><h2 class="empty-title${isGamingMode ? ' gaming-mode' : ''}">Loading Files</h2><p class="empty-message">Please wait while we load available files...</p></div>`;
            
            db.ref('files').once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        const filesData = snapshot.val();
                        files = [];
                        
                        // Convert object to array
                        Object.keys(filesData).forEach(key => {
                            if (filesData[key].status === 'active') {
                                const fileData = filesData[key];
                                fileData.id = key;
                                files.push(fileData);
                            }
                        });
                        
                        console.log(`â Files loaded: ${files.length} files found`);
                        
                        // If no files, create sample files
                        if (files.length === 0) {
                            createSampleFiles();
                        } else {
                            renderFiles('all');
                        }
                    } else {
                        // No files exist, create sample files
                        createSampleFiles();
                    }
                })
                .catch((error) => {
                    console.error("â Error loading files:", error);
                    showToast("Failed to load files", "error");
                    createSampleFiles();
                });
        }
        
        // Create sample files
        function createSampleFiles() {
            console.log("ð Creating sample files...");
            
            const sampleFiles = {
                file1: {
                    title: "Premium UI Kit",
                    description: "Complete UI kit with 50+ screens, components, and templates",
                    price: 500,
                    banner: "",
                    bkashNumber: "01712345678",
                    downloadUrl: "https://example.com/download/ui-kit.zip",
                    status: "active",
                    downloadCount: 42,
                    createdAt: new Date().toISOString()
                },
                file2: {
                    title: "E-commerce Template",
                    description: "Responsive e-commerce template with admin dashboard",
                    price: 300,
                    banner: "",
                    bkashNumber: "01712345678",
                    downloadUrl: "https://example.com/download/ecommerce.zip",
                    status: "active",
                    downloadCount: 28,
                    createdAt: new Date().toISOString()
                },
                file3: {
                    title: "Admin Dashboard",
                    description: "Modern admin dashboard with charts and widgets",
                    price: 0,
                    banner: "",
                    downloadUrl: "https://example.com/download/admin-dashboard.zip",
                    status: "active",
                    downloadCount: 156,
                    createdAt: new Date().toISOString()
                }
            };
            
            // Save to Realtime Database
            db.ref('files').set(sampleFiles)
                .then(() => {
                    console.log("â Sample files created");
                    // Reload files
                    loadFiles();
                })
                .catch((error) => {
                    console.error("Error creating sample files:", error);
                });
        }
        
        // Load notifications from Realtime Database
        function loadNotifications() {
            if (!currentUser) return;
            
            db.ref('notifications').orderByChild('userId').equalTo(currentUser.uid).once('value')
                .then((snapshot) => {
                    notifications = [];
                    if (snapshot.exists()) {
                        const notificationsData = snapshot.val();
                        Object.keys(notificationsData).forEach(key => {
                            const notificationData = notificationsData[key];
                            notificationData.id = key;
                            notifications.push(notificationData);
                        });
                        
                        // Sort by created date (newest first)
                        notifications.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    }
                    
                    if (document.getElementById('vaultPage').classList.contains('active')) {
                        renderVault();
                    }
                })
                .catch((error) => {
                    console.error("Error loading notifications:", error);
                });
        }
        
        // Load payments from Realtime Database
        function loadPayments() {
            if (!currentUser) return;
            
            db.ref('payments').orderByChild('userId').equalTo(currentUser.uid).once('value')
                .then((snapshot) => {
                    payments = [];
                    if (snapshot.exists()) {
                        const paymentsData = snapshot.val();
                        Object.keys(paymentsData).forEach(key => {
                            const paymentData = paymentsData[key];
                            paymentData.id = key;
                            payments.push(paymentData);
                        });
                    }
                    
                    updateProfileStats();
                })
                .catch((error) => {
                    console.error("Error loading payments:", error);
                });
        }
        
        // Update profile stats
        function updateProfileStats() {
            if (!currentUser) return;
            
            const approvedPayments = payments.filter(p => p.status === 'approved');
            const totalSpentAmount = approvedPayments.reduce((sum, payment) => sum + (parseInt(payment.amount) || 0), 0);
            
            totalPurchases.textContent = approvedPayments.length;
            totalSpent.textContent = `à§³${totalSpentAmount}`;
            
            // Update user in Realtime Database
            db.ref('users/' + currentUser.uid).update({
                purchaseCount: approvedPayments.length,
                totalSpent: totalSpentAmount,
                lastActive: new Date().toISOString()
            }).catch(error => {
                console.error("Error updating user stats:", error);
            });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            themeToggle.addEventListener('click', toggleTheme);
            if (themeToggleDesktop) {
                themeToggleDesktop.addEventListener('click', toggleTheme);
            }
            
            document.querySelectorAll('.nav-item, .desktop-nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    navigateTo(page);
                    document.querySelectorAll('.nav-item, .desktop-nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabType = this.getAttribute('data-tab');
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    renderFiles(tabType);
                });
            });
            
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const authType = this.getAttribute('data-auth');
                    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
                    document.getElementById(authType + 'Form').classList.add('active');
                    document.querySelectorAll('.form-error').forEach(error => error.style.display = 'none');
                });
            });
            
            document.getElementById('closeLoginModal').addEventListener('click', () => {
                loginModal.style.display = 'none';
            });
            
            document.getElementById('closeFileModal').addEventListener('click', () => {
                fileDetailsModal.style.display = 'none';
            });
            
            document.getElementById('closePaymentModal').addEventListener('click', () => {
                paymentModal.style.display = 'none';
            });
            
            document.getElementById('closeSuccessModal').addEventListener('click', () => {
                paymentSuccessModal.style.display = 'none';
            });
            
            showLoginFromForced.addEventListener('click', () => {
                forcedLoginOverlay.style.display = 'none';
                loginModal.style.display = 'flex';
            });
            
            userAvatar.addEventListener('click', () => {
                navigateTo('profile');
                document.querySelectorAll('.nav-item, .desktop-nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelectorAll('[data-page="profile"]').forEach(nav => nav.classList.add('active'));
            });
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                document.getElementById('loginEmailError').style.display = 'none';
                document.getElementById('loginPasswordError').style.display = 'none';
                
                if (!email || !password) {
                    showToast("Please fill in all fields", "error");
                    return;
                }
                
                const submitBtn = document.getElementById('loginSubmitBtn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
                submitBtn.disabled = true;
                
                console.log("ð Attempting login for:", email);
                
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        console.log("â Login successful");
                        showToast("Welcome back!", "success");
                        loginModal.style.display = 'none';
                        document.getElementById('loginEmail').value = '';
                        document.getElementById('loginPassword').value = '';
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    })
                    .catch((error) => {
                        console.error("â Login error:", error);
                        let errorMessage = "Login failed";
                        if (error.code === 'auth/user-not-found') {
                            errorMessage = "No account found with this email";
                        } else if (error.code === 'auth/wrong-password') {
                            errorMessage = "Incorrect password";
                        } else if (error.code === 'auth/too-many-requests') {
                            errorMessage = "Too many attempts. Try again later";
                        } else {
                            errorMessage = error.message;
                        }
                        showToast(errorMessage, "error");
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    });
            });
            
            // Register form
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('registerName').value.trim();
                const phone = document.getElementById('registerPhone').value.trim();
                const email = document.getElementById('registerEmail').value.trim();
                const password = document.getElementById('registerPassword').value;
                
                document.querySelectorAll('#registerForm .form-error').forEach(error => error.style.display = 'none');
                
                let hasError = false;
                if (!name) {
                    document.getElementById('registerNameError').textContent = "Name is required";
                    document.getElementById('registerNameError').style.display = 'block';
                    hasError = true;
                }
                if (!phone) {
                    document.getElementById('registerPhoneError').textContent = "Phone number is required";
                    document.getElementById('registerPhoneError').style.display = 'block';
                    hasError = true;
                }
                if (!email) {
                    document.getElementById('registerEmailError').textContent = "Email is required";
                    document.getElementById('registerEmailError').style.display = 'block';
                    hasError = true;
                }
                if (!password) {
                    document.getElementById('registerPasswordError').textContent = "Password is required";
                    document.getElementById('registerPasswordError').style.display = 'block';
                    hasError = true;
                } else if (password.length < 6) {
                    document.getElementById('registerPasswordError').textContent = "Password must be at least 6 characters";
                    document.getElementById('registerPasswordError').style.display = 'block';
                    hasError = true;
                }
                
                if (hasError) return;
                
                const submitBtn = document.getElementById('registerSubmitBtn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account...';
                submitBtn.disabled = true;
                
                console.log("ð Attempting registration for:", email);
                
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        console.log("â User created:", user.uid);
                        
                        return user.updateProfile({
                            displayName: name
                        }).then(() => {
                            const userData = {
                                uid: user.uid,
                                email: email,
                                name: name,
                                phone: phone,
                                createdAt: new Date().toISOString(),
                                purchaseCount: 0,
                                totalSpent: 0,
                                lastLogin: new Date().toISOString()
                            };
                            
                            return db.ref('users/' + user.uid).set(userData);
                        });
                    })
                    .then(() => {
                        console.log("â Registration complete");
                        showToast("Account created successfully!", "success");
                        loginModal.style.display = 'none';
                        document.getElementById('registerName').value = '';
                        document.getElementById('registerPhone').value = '';
                        document.getElementById('registerEmail').value = '';
                        document.getElementById('registerPassword').value = '';
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    })
                    .catch((error) => {
                        console.error("â Registration error:", error);
                        let errorMessage = "Registration failed";
                        if (error.code === 'auth/email-already-in-use') {
                            errorMessage = "Email already registered";
                            document.getElementById('registerEmailError').textContent = "Email already in use";
                            document.getElementById('registerEmailError').style.display = 'block';
                        } else if (error.code === 'auth/invalid-email') {
                            errorMessage = "Invalid email address";
                            document.getElementById('registerEmailError').textContent = "Invalid email address";
                            document.getElementById('registerEmailError').style.display = 'block';
                        } else if (error.code === 'auth/weak-password') {
                            errorMessage = "Password is too weak";
                            document.getElementById('registerPasswordError').textContent = "Password is too weak";
                            document.getElementById('registerPasswordError').style.display = 'block';
                        } else {
                            errorMessage = error.message;
                        }
                        showToast(errorMessage, "error");
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    });
            });
            
            // Copy bKash number
            document.getElementById('copyBkashBtn').addEventListener('click', function() {
                const bkashNumber = document.getElementById('bkashNumber').textContent;
                navigator.clipboard.writeText(bkashNumber).then(() => {
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    showToast("bKash number copied to clipboard", "success");
                    setTimeout(() => {
                        this.innerHTML = originalText;
                    }, 2000);
                }).catch(() => {
                    showToast("Failed to copy", "error");
                });
            });
            
            // Cancel payment
            document.getElementById('cancelPaymentBtn').addEventListener('click', () => {
                paymentModal.style.display = 'none';
            });
            
            // âââ REALTIME DATABASE PAYMENT SUBMIT âââ
            document.getElementById('submitPaymentBtn').addEventListener('click', async function() {
                await handlePaymentSubmit();
            });
            
            // Go to vault after success
            document.getElementById('goToVaultBtn').addEventListener('click', () => {
                paymentSuccessModal.style.display = 'none';
                navigateTo('vault');
                document.querySelectorAll('.nav-item, .desktop-nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelectorAll('[data-page="vault"]').forEach(nav => nav.classList.add('active'));
            });
            
            // Refresh profile
            refreshProfileBtn.addEventListener('click', () => {
                loadPayments();
                loadUserData(currentUser.uid);
                showToast("Profile refreshed!", "success");
            });
            
            // Logout
            logoutBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to logout?')) {
                    auth.signOut()
                        .then(() => {
                            console.log("â User signed out");
                            showToast("Logged out successfully", "success");
                            currentUser = null;
                            appContainer.style.display = 'none';
                            forcedLoginOverlay.style.display = 'flex';
                        })
                        .catch((error) => {
                            console.error("Logout error:", error);
                            showToast("Logout failed", "error");
                        });
                }
            });
            
            // Close modals on outside click
            window.addEventListener('click', function(e) {
                if (e.target === fileDetailsModal) fileDetailsModal.style.display = 'none';
                if (e.target === paymentModal) paymentModal.style.display = 'none';
                if (e.target === paymentSuccessModal) paymentSuccessModal.style.display = 'none';
                if (e.target === loginModal) loginModal.style.display = 'none';
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    fileDetailsModal.style.display = 'none';
                    paymentModal.style.display = 'none';
                    paymentSuccessModal.style.display = 'none';
                    loginModal.style.display = 'none';
                }
            });
        }
        
        // Navigation
        function navigateTo(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page + 'Page').classList.add('active');
            
            if (page === 'home') {
                renderFiles('all');
            } else if (page === 'vault') {
                renderVault();
            } else if (page === 'profile') {
                updateProfileUI();
            }
        }
        
        // Render files
        function renderFiles(filter = 'all') {
            filesGrid.innerHTML = '';
            
            let filteredFiles = files;
            if (filter === 'free') {
                filteredFiles = files.filter(file => file.price === 0 || file.price === '0');
            } else if (filter === 'paid') {
                filteredFiles = files.filter(file => file.price > 0);
            }
            
            if (filteredFiles.length === 0) {
                filesGrid.innerHTML = `<div class="empty-state${isGamingMode ? ' gaming-mode' : ''}" style="grid-column: 1 / -1;"><div class="empty-icon"><i class="fas fa-folder-open"></i></div><h2 class="empty-title${isGamingMode ? ' gaming-mode' : ''}">No files found</h2><p class="empty-message">Try a different filter or check back later</p></div>`;
                return;
            }
            
            filteredFiles.forEach((file, index) => {
                const fileCard = document.createElement('div');
                fileCard.className = `file-card${isGamingMode ? ' gaming-mode' : ''}`;
                fileCard.style.animationDelay = `${index * 0.05}s`;
                
                const price = file.price || 0;
                const isFree = price === 0 || price === '0';
                
                fileCard.innerHTML = `
                    <div class="file-banner">
                        ${file.banner ? `<img src="${file.banner}" alt="${file.title}">` : ''}
                        <div class="file-price-tag">${isFree ? 'FREE' : `à§³${price}`}</div>
                    </div>
                    <div class="file-content">
                        <h3 class="file-title${isGamingMode ? ' gaming-mode' : ''}">${file.title || 'Untitled File'}</h3>
                        <p class="file-description${isGamingMode ? ' gaming-mode' : ''}">${file.description || 'No description available'}</p>
                        <div class="file-footer">
                            <div class="file-meta${isGamingMode ? ' gaming-mode' : ''}">
                                <i class="fas fa-download"></i><span>${file.downloadCount || 0}</span>
                            </div>
                            <button class="btn-get${isGamingMode ? ' gaming-mode' : ''}" data-file-id="${file.id}">${isFree ? 'GET' : 'BUY'}</button>
                        </div>
                    </div>
                `;
                
                filesGrid.appendChild(fileCard);
            });
            
            document.querySelectorAll('.btn-get').forEach(btn => {
                btn.addEventListener('click', function() {
                    const fileId = this.getAttribute('data-file-id');
                    const file = files.find(f => f.id === fileId);
                    if (file) showFileDetails(file);
                });
            });
        }
        
        // Show file details
        function showFileDetails(file) {
            currentFile = file;
            console.log("ð Showing file:", file.title);
            
            const modalTitle = document.getElementById('fileModalTitle');
            const modalContent = document.getElementById('fileModalContent');
            
            modalTitle.textContent = file.title || 'File Details';
            
            const price = file.price || 0;
            const isFree = price === 0 || price === '0';
            
            let modalHTML = `
                <div style="text-align: center; margin-bottom: 24px;">
                    <div class="file-banner" style="border-radius: ${isGamingMode ? 'var(--border-radius-lg)' : 'var(--border-radius-md)'}; margin-bottom: 20px; height: 200px;">
                        ${file.banner ? `<img src="${file.banner}" alt="${file.title}" style="border-radius: ${isGamingMode ? 'var(--border-radius-lg)' : 'var(--border-radius-md)'};">` : '<i class="fas fa-file-code" style="font-size: 5rem; color: #4285f4; line-height: 200px;"></i>'}
                    </div>
                    <h3 style="margin-bottom: 8px; font-weight: 700; color: ${isGamingMode ? 'var(--gaming-text)' : 'var(--playstore-text)'};">${file.title || 'Untitled File'}</h3>
                    <p style="color: ${isGamingMode ? 'rgba(255,255,255,0.7)' : 'var(--playstore-text-secondary)'}; margin-bottom: 20px; line-height: 1.6;">${file.description || 'No description available'}</p>
                    <div style="font-size: 2rem; font-weight: 800; margin-bottom: 24px; color: ${isFree ? (isGamingMode ? '#34a853' : 'var(--secondary)') : (isGamingMode ? '#ff375f' : 'var(--danger)')}">
                        ${isFree ? 'FREE' : `à§³${price}`}
                    </div>
                </div>
            `;
            
            if (isFree) {
                modalHTML += `<button class="btn btn-primary${isGamingMode ? ' gaming-mode' : ''}" id="downloadFreeBtn" style="width: 100%;"><i class="fas fa-download"></i> DOWNLOAD NOW</button>`;
            } else {
                modalHTML += `<button class="btn btn-primary${isGamingMode ? ' gaming-mode' : ''}" id="buyFileBtn" style="width: 100%;"><i class="fas fa-shopping-cart"></i> BUY NOW - à§³${price}</button>`;
            }
            
            modalContent.innerHTML = modalHTML;
            
            if (isGamingMode) {
                document.querySelector('#fileDetailsModal .modal').classList.add('gaming-mode');
                document.querySelector('#fileDetailsModal .modal-header').classList.add('gaming-mode');
                document.querySelector('#fileDetailsModal .modal-title').classList.add('gaming-mode');
                document.querySelector('#fileDetailsModal .modal-close').classList.add('gaming-mode');
            } else {
                document.querySelector('#fileDetailsModal .modal').classList.remove('gaming-mode');
                document.querySelector('#fileDetailsModal .modal-header').classList.remove('gaming-mode');
                document.querySelector('#fileDetailsModal .modal-title').classList.remove('gaming-mode');
                document.querySelector('#fileDetailsModal .modal-close').classList.remove('gaming-mode');
            }
            
            fileDetailsModal.style.display = 'flex';
            fileDetailsModal.classList.add('active');
            
            setTimeout(() => {
                if (isFree) {
                    document.getElementById('downloadFreeBtn').addEventListener('click', () => {
                        downloadFile(file);
                        fileDetailsModal.style.display = 'none';
                        fileDetailsModal.classList.remove('active');
                    });
                } else {
                    document.getElementById('buyFileBtn').addEventListener('click', () => {
                        fileDetailsModal.style.display = 'none';
                        fileDetailsModal.classList.remove('active');
                        showPaymentModal(file);
                    });
                }
            }, 100);
        }
        
        // Show payment modal
        function showPaymentModal(file) {
            console.log("ð° Showing payment modal for:", file.title);
            
            document.getElementById('paymentProduct').textContent = file.title || 'Product';
            document.getElementById('paymentPrice').textContent = `à§³${file.price || 0}`;
            document.getElementById('bkashNumber').textContent = file.bkashNumber || '01712345678';
            document.getElementById('successAmount').textContent = `à§³${file.price || 0}`;
            document.getElementById('successProduct').textContent = file.title || 'Product';
            
            document.getElementById('trxId').value = '';
            document.getElementById('trxIdError').style.display = 'none';
            
            paymentModal.style.display = 'flex';
            paymentModal.classList.add('active');
        }
        
        // âââ REALTIME DATABASE PAYMENT SUBMIT FUNCTION âââ
        async function handlePaymentSubmit() {
            try {
                // Basic validation
                if (!currentUser || !currentUser.uid) {
                    showToast("User not logged in", "error");
                    return;
                }
                
                if (!currentFile) {
                    showToast('No file selected', 'error');
                    return;
                }
                
                const trxId = document.getElementById('trxId').value.trim();
                if (!trxId || trxId.length < 8) {
                    showToast('Enter valid Transaction ID (min 8 chars)', 'error');
                    return;
                }
                
                // Confirm payment
                if (!confirm(`Pay à§³${currentFile.price} for "${currentFile.title}"?\nTransaction ID: ${trxId}`)) {
                    return;
                }
                
                // Disable button
                const submitBtn = document.getElementById('submitPaymentBtn');
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                submitBtn.disabled = true;
                
                console.log("ð Starting Realtime DB payment submission...");
                
                // Generate unique ID for payment
                const paymentId = 'payment_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                // Payment data for Realtime Database
                const paymentData = {
                    userId: currentUser.uid,
                    userEmail: currentUser.email || "",
                    userName: currentUser.name || "User",
                    userPhone: currentUser.phone || "",
                    fileId: currentFile.id,
                    fileTitle: currentFile.title || "Untitled File",
                    fileDescription: currentFile.description || "",
                    filePrice: Number(currentFile.price) || 0,
                    amount: Number(currentFile.price) || 0,
                    bkashNumber: currentFile.bkashNumber || "01712345678",
                    transactionId: trxId,
                    status: "pending",
                    createdAt: new Date().toISOString(),
                    adminNote: "",
                    downloadUrl: "",
                    reviewed: false
                };
                
                console.log("ð¤ Payment data prepared for Realtime DB");
                
                // Step 1: Test Realtime Database connection
                console.log("Testing Realtime DB connection...");
                const testRef = db.ref('test_connection/' + Date.now());
                await testRef.set({
                    test: true,
                    userId: currentUser.uid,
                    timestamp: new Date().toISOString()
                });
                console.log("â Realtime DB test successful");
                await testRef.remove();
                console.log("â Test data cleaned up");
                
                // Step 2: Save payment to Realtime Database
                console.log("Saving payment to Realtime DB...");
                await db.ref('payments/' + paymentId).set(paymentData);
                console.log("â Payment saved to Realtime DB with ID:", paymentId);
                
                // Step 3: Create notification
                const notificationId = 'notif_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const notificationData = {
                    userId: currentUser.uid,
                    type: 'payment',
                    status: 'pending',
                    title: 'Payment Submitted',
                    message: `Payment of à§³${currentFile.price} for "${currentFile.title}" has been submitted. Admin will review within 24 hours.`,
                    paymentId: paymentId,
                    fileId: currentFile.id,
                    fileTitle: currentFile.title,
                    filePrice: Number(currentFile.price) || 0,
                    read: false,
                    createdAt: new Date().toISOString()
                };
                
                await db.ref('notifications/' + notificationId).set(notificationData);
                console.log("â Notification created with ID:", notificationId);
                
                // Step 4: Show success
                paymentModal.style.display = 'none';
                paymentModal.classList.remove('active');
                
                paymentSuccessModal.style.display = 'flex';
                paymentSuccessModal.classList.add('active');
                
                showToast('â Payment submitted successfully!', 'success');
                
                // Reset button
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Payment';
                submitBtn.disabled = false;
                
                // Reload data
                setTimeout(() => {
                    loadNotifications();
                    loadPayments();
                }, 1000);
                
            } catch (error) {
                console.error("â Realtime DB Payment error:", error);
                
                let errorMsg = "Payment submission failed. ";
                if (error.code === 'PERMISSION_DENIED') {
                    errorMsg = "Database permission denied. Check Realtime DB rules.";
                } else if (error.message.includes('permission')) {
                    errorMsg = "Database rules issue. Check Firebase Console.";
                } else {
                    errorMsg += error.message || "Unknown error";
                }
                
                showToast(errorMsg, 'error');
                
                // Reset button
                const submitBtn = document.getElementById('submitPaymentBtn');
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Payment';
                submitBtn.disabled = false;
            }
        }
        
        // Download file
        function downloadFile(file) {
            if (file.downloadUrl) {
                window.open(file.downloadUrl, '_blank');
                console.log("ð¥ Downloading file:", file.title);
                showToast('Download started!', 'success');
                
                // Increment download count in Realtime Database
                const newCount = (file.downloadCount || 0) + 1;
                db.ref('files/' + file.id + '/downloadCount').set(newCount)
                    .catch(error => {
                        console.error("Error updating download count:", error);
                    });
            } else {
                showToast('Download link not available', 'error');
            }
        }
        
        // Render vault
        function renderVault() {
            vaultContainer.innerHTML = '';
            
            if (notifications.length === 0) {
                vaultContainer.innerHTML = `<div class="empty-state${isGamingMode ? ' gaming-mode' : ''}"><div class="empty-icon"><i class="fas fa-inbox"></i></div><h2 class="empty-title${isGamingMode ? ' gaming-mode' : ''}">No notifications</h2><p class="empty-message">Your vault is empty. Purchase a file to see it here.</p></div>`;
                return;
            }
            
            notifications.forEach((notification, index) => {
                const notifCard = document.createElement('div');
                notifCard.className = `notification-card ${notification.status}${isGamingMode ? ' gaming-mode' : ''}`;
                notifCard.style.animationDelay = `${index * 0.05}s`;
                
                // Format timestamp
                let timestamp = 'Just now';
                if (notification.createdAt) {
                    const date = new Date(notification.createdAt);
                    const now = new Date();
                    const diff = now - date;
                    const minutes = Math.floor(diff / 60000);
                    const hours = Math.floor(diff / 3600000);
                    const days = Math.floor(diff / 86400000);
                    
                    if (minutes < 60) timestamp = `${minutes}m ago`;
                    else if (hours < 24) timestamp = `${hours}h ago`;
                    else timestamp = `${days}d ago`;
                }
                
                let statusBadge = '';
                if (notification.status === 'pending') statusBadge = '<span style="color: var(--warning);"><i class="fas fa-clock"></i> Pending</span>';
                else if (notification.status === 'approved') statusBadge = '<span style="color: var(--secondary);"><i class="fas fa-check-circle"></i> Approved</span>';
                else if (notification.status === 'rejected') statusBadge = '<span style="color: var(--danger);"><i class="fas fa-times-circle"></i> Rejected</span>';
                
                let fileSection = '';
                if (notification.fileId) {
                    fileSection = `
                        <div style="background: ${isGamingMode ? 'rgba(255,255,255,0.05)' : 'var(--playstore-bg)'}; padding: 16px; border-radius: var(--border-radius-md); margin: 16px 0; border-left: 4px solid ${isGamingMode ? 'rgba(255,255,255,0.1)' : 'var(--playstore-border)'};">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="width: 50px; height: 50px; background: ${isGamingMode ? 'rgba(255,255,255,0.1)' : 'var(--playstore-surface)'}; border-radius: var(--border-radius-sm); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: ${isGamingMode ? '#ff375f' : 'var(--primary)'};">
                                    <i class="fas fa-file-code"></i>
                                </div>
                                <div>
                                    <h4 style="font-weight: 700; margin-bottom: 4px; color: ${isGamingMode ? 'var(--gaming-text)' : 'var(--playstore-text)'};">${notification.fileTitle || 'File'}</h4>
                                    <p style="font-size: 0.9rem; color: ${isGamingMode ? 'rgba(255,255,255,0.7)' : 'var(--playstore-text-secondary)'};">Price: à§³${notification.filePrice || 0}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                let reasonSection = '';
                if (notification.status === 'rejected' && notification.reason) {
                    reasonSection = `<div style="background: rgba(234, 67, 53, 0.1); padding: 12px; border-radius: var(--border-radius-md); margin-top: 12px; border-left: 4px solid var(--danger);"><p style="margin: 0; font-size: 0.9rem; color: var(--danger);"><strong><i class="fas fa-exclamation-circle"></i> Reason:</strong> ${notification.reason}</p></div>`;
                }
                
                let actionButton = '';
                if (notification.status === 'approved' && notification.downloadUrl) {
                    actionButton = `<button class="btn btn-success${isGamingMode ? ' gaming-mode' : ''}" style="width: 100%; margin-top: 16px;" data-download-url="${notification.downloadUrl}"><i class="fas fa-download"></i> Download File</button>`;
                }
                
                notifCard.innerHTML = `
                    <div class="notification-header">
                        <div class="notification-title${isGamingMode ? ' gaming-mode' : ''}">${notification.title || 'Notification'}</div>
                        <div class="notification-time${isGamingMode ? ' gaming-mode' : ''}">${timestamp} ${statusBadge}</div>
                    </div>
                    <div class="notification-message${isGamingMode ? ' gaming-mode' : ''}">${notification.message || ''}</div>
                    ${fileSection}${reasonSection}${actionButton}
                `;
                
                vaultContainer.appendChild(notifCard);
            });
            
            setTimeout(() => {
                document.querySelectorAll('.btn-success[data-download-url]').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const downloadUrl = this.getAttribute('data-download-url');
                        if (downloadUrl) {
                            window.open(downloadUrl, '_blank');
                            showToast('Download started!', 'success');
                        }
                    });
                });
            }, 100);
        }
        
        // Update profile UI
        function updateProfileUI() {
            if (!currentUser) return;
            
            const firstName = currentUser.name ? currentUser.name.split(' ')[0] : currentUser.email.split('@')[0];
            const firstLetter = firstName.charAt(0).toUpperCase();
            
            profileAvatar.textContent = firstLetter;
            profileName.textContent = currentUser.name || currentUser.email.split('@')[0];
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('profilePhone').textContent = currentUser.phone || 'Not provided';
            
            // Format join date
            if (currentUser.createdAt) {
                const joinDate = new Date(currentUser.createdAt);
                const options = { year: 'numeric', month: 'long' };
                document.getElementById('profileJoined').textContent = joinDate.toLocaleDateString('en-US', options);
            } else {
                document.getElementById('profileJoined').textContent = 'Recently';
            }
            
            userAvatar.textContent = firstLetter;
        }
        
        // Update UI after login
        function updateUIForUser() {
            updateProfileUI();
            renderFiles('all');
            navigateTo('home');
        }
        
        // Setup real-time listeners for Realtime Database
        function setupRealTimeListeners() {
            if (!currentUser) return;
            
            console.log("Setting up Realtime DB listeners...");
            
            // Files listener
            db.ref('files').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const filesData = snapshot.val();
                    files = [];
                    
                    Object.keys(filesData).forEach(key => {
                        if (filesData[key].status === 'active') {
                            const fileData = filesData[key];
                            fileData.id = key;
                            files.push(fileData);
                        }
                    });
                    
                    if (document.getElementById('homePage').classList.contains('active')) {
                        const activeTab = document.querySelector('.tab.active');
                        const filter = activeTab ? activeTab.getAttribute('data-tab') : 'all';
                        renderFiles(filter);
                    }
                }
            });
            
            // Notifications listener for current user
            db.ref('notifications').orderByChild('userId').equalTo(currentUser.uid).on('value', (snapshot) => {
                notifications = [];
                if (snapshot.exists()) {
                    const notificationsData = snapshot.val();
                    Object.keys(notificationsData).forEach(key => {
                        const notificationData = notificationsData[key];
                        notificationData.id = key;
                        notifications.push(notificationData);
                    });
                    
                    // Sort by created date (newest first)
                    notifications.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    
                    if (document.getElementById('vaultPage').classList.contains('active')) {
                        renderVault();
                    }
                }
            });
            
            // Payments listener for current user
            db.ref('payments').orderByChild('userId').equalTo(currentUser.uid).on('value', (snapshot) => {
                payments = [];
                if (snapshot.exists()) {
                    const paymentsData = snapshot.val();
                    Object.keys(paymentsData).forEach(key => {
                        const paymentData = paymentsData[key];
                        paymentData.id = key;
                        payments.push(paymentData);
                    });
                    
                    updateProfileStats();
                }
            });
        }
        
        // Initialize theme
        updateUITheme();
        
        // Test Realtime Database connection
        window.testRealtimeDB = function() {
            if (!currentUser) {
                showToast("Please login first", "error");
                return;
            }
            
            const testData = {
                test: true,
                userId: currentUser.uid,
                timestamp: new Date().toISOString()
            };
            
            db.ref('test/' + Date.now()).set(testData)
                .then(() => {
                    showToast("â Realtime DB connection successful!", "success");
                })
                .catch(error => {
                    showToast(`â Realtime DB error: ${error.message}`, "error");
                });
        };
    </script>
</body>
</html>